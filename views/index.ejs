<%- include('partials/header') %>

<div class="p-4 mb-4 bg-light rounded-3 shadow-sm">
    <h1 class="display-5 fw-bold text-primary">
        <i class="fas fa-boxes me-2"></i> Danh sách Sản phẩm
    </h1>
    <p class="lead text-muted">
        Tìm kiếm và lọc sản phẩm theo nhu cầu của bạn.
    </p>
</div>

<!-- Thanh công cụ tìm kiếm & lọc -->
<form action="/" method="GET" class="row g-3 mb-4 align-items-center justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="input-group">
            <span class="input-group-text bg-primary text-white">
                <i class="fas fa-search"></i>
            </span>
            <input 
    type="text" 
    class="form-control form-control-lg" 
    name="search" 
    placeholder="Tìm sản phẩm..." 
    value="<%= typeof search !== 'undefined' ? search : '' %>"
/>
        </div>
    </div>

    <div class="col-md-4 col-lg-3">
        <select name="supplier" class="form-select form-select-lg">
            <option value="">-- Lọc theo nhà cung cấp --</option>
            <% suppliers.forEach(supplier => { %>
                <option value="<%= supplier._id %>" <%= (selectedSupplier == supplier._id) ? 'selected' : '' %>>
                    <%= supplier.name %>
                </option>
            <% }) %>
        </select>
    </div>

    <div class="col-md-2 col-lg-2">
        <button type="submit" class="btn btn-primary btn-lg w-100">
            <i class="fas fa-filter me-1"></i> Tìm
        </button>
    </div>
</form>

<!-- Hiển thị sản phẩm -->
<div class="row g-4">
    <% if (products.length > 0) { %>
        <% products.forEach(product => { %>
            <div class="col-md-4">
                <div class="card h-100 shadow-sm border-0 hover-scale">
                    <div class="card-body p-4">
                        <h5 class="card-title fw-semibold text-dark">
                            <%= product.name %>
                        </h5>
                        
                        <p class="card-text text-muted small mb-2">
                            <i class="fas fa-building me-1 text-secondary"></i>
                            Nhà cung cấp: 
                            <strong><%= product.supplier ? product.supplier.name : 'Chưa có' %></strong>
                        </p>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-success px-3 py-2">
                                <i class="fas fa-tag me-1"></i>
                                Giá: <strong><%= product.price.toLocaleString('vi-VN') %> VNĐ</strong>
                            </span>
                            <span class="badge bg-info px-3 py-2">
                                <i class="fas fa-box me-1"></i>
                                Còn: <strong><%= product.quantity %></strong>
                            </span>
                        </div>

                        <!-- Nút hành động (nếu cần) -->
                        <div class="d-grid gap-2">
                            <a href="/admin/products/edit/<%= product._id %>" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-edit me-1"></i> Sửa
                            </a>
                            <a href="/admin/products/delete/<%= product._id %>" class="btn btn-outline-danger btn-sm" onclick="return confirm('Xác nhận xóa?')">
                                <i class="fas fa-trash-alt me-1"></i> Xóa
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        <% }) %>
    <% } else { %>
        <div class="col-12 text-center py-5">
            <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
            <p class="fs-5 text-muted">Không tìm thấy sản phẩm nào.</p>
            <a href="/admin/products/add" class="btn btn-primary mt-2">
                <i class="fas fa-plus me-1"></i> Thêm sản phẩm mới
            </a>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>